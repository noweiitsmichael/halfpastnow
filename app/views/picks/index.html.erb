<% content_for :meta do %>
     <meta property="og:type"                 content="website"> 
     <meta property="og:url"                  content="http://www.halfpastnow.com/picks">
     <meta property="og:site_name"            content="halfpastnow">
     <meta property="og:image"                content="">
     <meta property="og:title"                content="half past now | Events from Trendsetters">
     <meta property="og:description"          content="The best events in town, handpicked by local trendsetters"> 
<% end %>
<% content_for :code do %>
	<script type="text/javascript">

		$(function() {

			$('#list-cat').change(function(){
				window.location = "/picks/index/"+$(this).val()
			});
			$('.follow.button').click(function() {
  				var $that = $(this);
				var listID = $that.attr('picklist-id');
				var url = 'http://halfpastnow.com/picks/find/'+listID
				console.log('test folling'+url);

				FB.api(
				            '/me/halfpastnow:subscribe',
				            'post',
				            { toppick: url },
				            function(response) {
				        });
				$.getJSON('/users/followBookmarkList/' + listID, function(data) {
					if(data.success) {
						$that.hide();
						$that.siblings('.unfollow.button').show();
					} else {
						console.log(data.error);
					}
				});
			});

			$('.unfollow.button').click(function() {
				var $that = $(this);
				var listID = $that.attr('picklist-id');
				$.getJSON('/users/unfollowBookmarkList/' + listID, function(data) {
					if(data.success) {
						$that.hide();
						$that.siblings('.follow.button').show();
					} else {
						console.log(data.error);
					}
				});
			});

			var event_id = <%= params[:event_id] || "null" %>;
			var venue_id = <%= params[:venue_id] || "null" %>;
			var act_id = <%= params[:act_id] || "null" %>;
			var modality;

			if(event_id) {
				modality = spawn(modalities["event"],{id: event_id});
				modal(modality);
			}
			if(venue_id) {
				modality = spawn(modalities["venue"],{id: venue_id});
				modal(modality);
			}
			if(act_id) {
				modality = spawn(modalities["act"],{id: act_id});
				modal(modality);   
			}
		});
	</script>
<% end %>

<% content_for :header do %>
	<div class="titlebar">
		<div class="stay-on-target">
			<%= render :partial => "title", :locals => { :page_action => params[:action] } %>
		</div>
	</div>
<% end %>

<% content_for :body do %>

	<% def insert_day(day, d) %>
		<div class="picklist list<%= (d % 3 == 2) ? "-left" : "" %> ">
		<div class="list-cat-label"><%= day.to_time.strftime("%A, %B %-d") %></div>
		   <% unless (@result.empty?) %>
			   <% occurrences = @result.select { |b| b if (b["start"].to_date == day) } %>
			   <% occurrences = occurrences.first(4)%>
			   <% puts "-----THIS DAY'S EVENTS-----"
			   		y occurrences %>
				<ul class="picklist-events">
		   		<% unless (occurrences.blank?) %>
					<% occurrences.each do |occurrence| %>
			   			<% unless (occurrence.nil?) %>
							<li linkto="event" link-id="<%= occurrence["id"] %>">
								<img class="picture" src="<%= occurrence["cover_image_url"] ? occurrence["cover_image_url"] : "/assets/placeholder.png" %>" />
								<div class="title"><%= occurrence["title"] %></div>
								<div class="venue"><%= occurrence["name"] %> @ <%= occurrence["start"].to_time.strftime("%-l:%M%P") %></div>
								<div class="datetime"></div>
							</li>
						<% end %>
					<% end %>
				<% end %>
				</ul>
			<% end %>
		</div>
	<% end %>
	<div id="info-content" class="top-picks">
		<% unless(@isFollowedLists) %>
		<div id="list-cat-wrapper">
			<div class="list-cat-heading">Upcoming Top Pick Events</div>
			<div class="list-cat-label">The best events in Austin, handpicked by locals and trendsetters</div>
		</div>
		<% end %>
		<% if(@isFollowedLists) %>
			<div style="font-weight: 700;margin: 9px 0 0 11px;font-size: 16px;">List View | <a href="/picks/followed?events=true">Event View</a></div>
		<% end %>
		<% hidden = "style=\"display:none;\"" %>
		<div class='pick-cal'>
			<% 	(0..6).each do |d| 
					insert_day(Date.today + d.days, d)
				end
			%>
		</div>
		
	</div>


	
<% end %>

